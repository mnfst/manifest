openapi: 3.1.0
info:
  title: Theme Editor API
  description: |
    API contract for the App Theme Editor feature.
    This feature uses the existing PATCH /apps/:id endpoint - no new endpoints required.
  version: 1.0.0

paths:
  /api/apps/{appId}:
    patch:
      summary: Update app theme variables
      description: |
        Updates the theme variables for an app. Supports partial updates -
        only the variables included in the request body will be modified.
        Existing variables not in the request are preserved.
      operationId: updateAppTheme
      tags:
        - Apps
      parameters:
        - name: appId
          in: path
          required: true
          description: UUID of the app to update
          schema:
            type: string
            format: uuid
            example: "550e8400-e29b-41d4-a716-446655440000"
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/UpdateThemeRequest'
            examples:
              partialUpdate:
                summary: Update only primary colors
                value:
                  themeVariables:
                    --primary: "222.2 47.4% 11.2%"
                    --primary-foreground: "210 40% 98%"
              fullUpdate:
                summary: Update all theme variables
                value:
                  themeVariables:
                    --primary: "222.2 47.4% 11.2%"
                    --primary-foreground: "210 40% 98%"
                    --background: "0 0% 100%"
                    --foreground: "222.2 47.4% 11.2%"
                    --muted: "210 40% 96.1%"
                    --muted-foreground: "215.4 16.3% 46.9%"
                    --accent: "210 40% 96.1%"
                    --accent-foreground: "222.2 47.4% 11.2%"
                    --card: "0 0% 100%"
                    --card-foreground: "222.2 47.4% 11.2%"
                    --border: "214.3 31.8% 91.4%"
                    --input: "214.3 31.8% 91.4%"
                    --ring: "222.2 47.4% 11.2%"
                    --radius: "0.5rem"
              resetToDefaults:
                summary: Reset to default theme
                description: Send all default values to reset the theme
                value:
                  themeVariables:
                    --primary: "222.2 47.4% 11.2%"
                    --primary-foreground: "210 40% 98%"
                    --background: "0 0% 100%"
                    --foreground: "222.2 47.4% 11.2%"
                    --muted: "210 40% 96.1%"
                    --muted-foreground: "215.4 16.3% 46.9%"
                    --accent: "210 40% 96.1%"
                    --accent-foreground: "222.2 47.4% 11.2%"
      responses:
        '200':
          description: App updated successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/App'
        '400':
          description: Invalid theme variables format
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ValidationError'
              example:
                statusCode: 400
                message: "Invalid HSL value for --primary"
                error: "Bad Request"
        '404':
          description: App not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/NotFoundError'
              example:
                statusCode: 404
                message: "App with id 550e8400-e29b-41d4-a716-446655440000 not found"
                error: "Not Found"

    get:
      summary: Get app details including theme variables
      description: |
        Retrieves the full app details including the current theme variables.
        Used to load the theme editor initial state.
      operationId: getApp
      tags:
        - Apps
      parameters:
        - name: appId
          in: path
          required: true
          schema:
            type: string
            format: uuid
      responses:
        '200':
          description: App details
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/App'
        '404':
          description: App not found

components:
  schemas:
    ThemeVariables:
      type: object
      description: |
        CSS custom properties for theming. All color values use HSL format
        as space-separated strings: "{hue} {saturation}% {lightness}%"
      properties:
        --primary:
          type: string
          description: Primary brand color
          example: "222.2 47.4% 11.2%"
          pattern: "^\\d+(?:\\.\\d+)?\\s+\\d+(?:\\.\\d+)?%\\s+\\d+(?:\\.\\d+)?%$"
        --primary-foreground:
          type: string
          description: Text color on primary backgrounds
          example: "210 40% 98%"
        --background:
          type: string
          description: Page background color
          example: "0 0% 100%"
        --foreground:
          type: string
          description: Default text color
          example: "222.2 47.4% 11.2%"
        --muted:
          type: string
          description: Muted background color
          example: "210 40% 96.1%"
        --muted-foreground:
          type: string
          description: Muted text color
          example: "215.4 16.3% 46.9%"
        --accent:
          type: string
          description: Accent/highlight color
          example: "210 40% 96.1%"
        --accent-foreground:
          type: string
          description: Text color on accent backgrounds
          example: "222.2 47.4% 11.2%"
        --card:
          type: string
          description: Card background color
          example: "0 0% 100%"
        --card-foreground:
          type: string
          description: Card text color
          example: "222.2 47.4% 11.2%"
        --popover:
          type: string
          description: Popover background color
          example: "0 0% 100%"
        --popover-foreground:
          type: string
          description: Popover text color
          example: "222.2 47.4% 11.2%"
        --secondary:
          type: string
          description: Secondary action color
          example: "210 40% 96.1%"
        --secondary-foreground:
          type: string
          description: Text on secondary backgrounds
          example: "222.2 47.4% 11.2%"
        --border:
          type: string
          description: Border color
          example: "214.3 31.8% 91.4%"
        --input:
          type: string
          description: Input border color
          example: "214.3 31.8% 91.4%"
        --ring:
          type: string
          description: Focus ring color
          example: "222.2 47.4% 11.2%"
        --destructive:
          type: string
          description: Destructive action color
          example: "0 84.2% 60.2%"
        --destructive-foreground:
          type: string
          description: Text on destructive backgrounds
          example: "210 40% 98%"
        --radius:
          type: string
          description: Border radius value
          example: "0.5rem"
          pattern: "^\\d+(?:\\.\\d+)?(rem|px|em)$"
      required:
        - --primary
        - --primary-foreground
        - --background
        - --foreground
        - --muted
        - --muted-foreground
        - --accent
        - --accent-foreground

    UpdateThemeRequest:
      type: object
      properties:
        themeVariables:
          $ref: '#/components/schemas/ThemeVariables'
      description: |
        Request body for updating theme variables.
        Only include the variables you want to update - missing variables are preserved.

    App:
      type: object
      properties:
        id:
          type: string
          format: uuid
        name:
          type: string
          maxLength: 100
        description:
          type: string
          maxLength: 500
          nullable: true
        slug:
          type: string
        themeVariables:
          $ref: '#/components/schemas/ThemeVariables'
        status:
          type: string
          enum: [draft, published, archived]
        logoUrl:
          type: string
          nullable: true
        createdAt:
          type: string
          format: date-time
        updatedAt:
          type: string
          format: date-time
      required:
        - id
        - name
        - slug
        - themeVariables
        - status
        - createdAt
        - updatedAt

    ValidationError:
      type: object
      properties:
        statusCode:
          type: integer
          example: 400
        message:
          type: string
        error:
          type: string
          example: "Bad Request"

    NotFoundError:
      type: object
      properties:
        statusCode:
          type: integer
          example: 404
        message:
          type: string
        error:
          type: string
          example: "Not Found"

tags:
  - name: Apps
    description: App management endpoints (existing)
