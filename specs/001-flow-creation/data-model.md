# Data Model: Simplified Flow Creation

**Feature**: 001-flow-creation
**Date**: 2025-12-28

## Overview

This feature does not add new entities but modifies how the existing `Flow` entity is created and initially populated. The key change is that flows are now created with minimal data (name, description, auto-generated toolName) and have empty user intent fields until the user explicitly sets them.

## Entities

### Flow (Modified Behavior)

The Flow entity schema remains unchanged. The modification is in the **creation behavior**:

| Field | Type | Constraints | Creation Behavior |
|-------|------|-------------|-------------------|
| `id` | UUID | PK, auto-generated | Generated by database |
| `appId` | UUID | FK to App, required | Provided by API route |
| `name` | varchar(300) | required | **User input (modal)** |
| `description` | varchar(500) | nullable | **User input (modal)** |
| `toolName` | varchar(100) | required | **Auto-generated from name** |
| `toolDescription` | varchar(500) | required (DB) | **Empty string on creation** |
| `whenToUse` | varchar(500) | nullable | **null on creation** |
| `whenNotToUse` | varchar(500) | nullable | **null on creation** |
| `isActive` | boolean | default: true | true |
| `createdAt` | timestamp | auto | Auto-generated |
| `updatedAt` | timestamp | auto | Auto-generated |

### Flow States

The feature introduces implicit flow states based on field values:

```
┌─────────────────────────────────────────────────────────────────┐
│                         FLOW STATES                              │
├─────────────────────────────────────────────────────────────────┤
│                                                                  │
│  ┌──────────────┐    User saves     ┌──────────────────┐        │
│  │   CREATED    │    user intent    │  HAS_USER_INTENT │        │
│  │              │ ─────────────────→│                  │        │
│  │ toolDesc=""  │                   │ toolDesc="..."   │        │
│  │ views=[]     │                   │ views=[]         │        │
│  └──────────────┘                   └────────┬─────────┘        │
│         │                                    │                   │
│         │ (Can add user intent)              │ User adds view   │
│         │                                    ↓                   │
│         │                           ┌──────────────────┐        │
│         │                           │    COMPLETE      │        │
│         │                           │                  │        │
│         │                           │ toolDesc="..."   │        │
│         │                           │ views=[...]      │        │
│         │                           └──────────────────┘        │
│         │                                    │                   │
│         └────────────────────────────────────┘                   │
│                   (Flow is usable as MCP tool)                   │
│                                                                  │
└─────────────────────────────────────────────────────────────────┘
```

### State Detection Logic

```typescript
interface FlowState {
  hasUserIntent: boolean;  // toolDescription is non-empty
  hasViews: boolean;       // views array has items
  isComplete: boolean;     // hasUserIntent && hasViews
}

function getFlowState(flow: Flow): FlowState {
  const hasUserIntent = Boolean(flow.toolDescription?.trim());
  const hasViews = Boolean(flow.views?.length);
  return {
    hasUserIntent,
    hasViews,
    isComplete: hasUserIntent && hasViews,
  };
}
```

## Validation Rules

### Flow Name (Frontend & Backend)

| Rule | Description |
|------|-------------|
| Required | Name cannot be empty |
| Max length | 300 characters |
| Valid tool name | Must produce at least one alphanumeric character when converted to snake_case |

### Tool Name Generation

| Input | Output | Valid |
|-------|--------|-------|
| "My Product Catalog" | "my_product_catalog" | Yes |
| "Hello World!" | "hello_world" | Yes |
| "API v2.0 Integration" | "api_v20_integration" | Yes |
| "   Spaces   Trimmed   " | "spaces_trimmed" | Yes |
| "!!!" | "" | No - validation error |
| "" | "" | No - validation error |

### Tool Name Conversion Algorithm

```typescript
function toSnakeCase(name: string): string {
  return name
    .toLowerCase()
    .replace(/[^a-z0-9\s]/g, '')  // Remove special characters
    .trim()
    .replace(/\s+/g, '_')          // Convert spaces to underscores
    .replace(/_+/g, '_')           // Collapse multiple underscores
    .replace(/^_|_$/g, '');        // Trim leading/trailing underscores
}

function isValidToolName(toolName: string): boolean {
  return toolName.length > 0 && /^[a-z][a-z0-9_]*$/.test(toolName);
}
```

## Entity Relationships

No changes to existing relationships:

```
App (1) ──────< Flow (many)
                   │
                   └──────< View (many)
```

## Migration Notes

**No database migration required.** The schema remains unchanged.

The only behavioral change is:
- `toolDescription` is now created as empty string instead of AI-generated value
- No initial View is created (previously one was created via AI)

Existing flows created via the old prompt-based system will continue to work normally.
