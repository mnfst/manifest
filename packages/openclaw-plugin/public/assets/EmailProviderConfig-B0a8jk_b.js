import{j as Q,c as U,k as W,a as o,l as X,i as a,b as m,S as f,d as c,s as Z,t as l,m as ee,e as p,g as te,n as se,o as ie,h as ae}from"./index-D02tkJyD.js";var le=l("<h3 class=settings-section__title>Email Provider"),ne=l('<div class="waiting-banner waiting-banner--success"role=status><i class="bxd bx-check-circle"></i><p>Email delivery is configured via <strong></strong>.'),re=l("<span class=settings-card__label-desc>Leave blank to keep existing key."),ce=l("<div class=settings-card__row><div class=settings-card__label><span class=settings-card__label-title>Domain</span><span class=settings-card__label-desc>Your Mailgun sending domain (e.g. mg.example.com)</span></div><div class=settings-card__control><input class=settings-card__input type=text placeholder=mg.example.com>"),de=l("<div class=email-config__form><div class=settings-card__row><div class=settings-card__label><span class=settings-card__label-title>Provider</span></div><div class=settings-card__control><select class=settings-card__input></select></div></div><div class=settings-card__row><div class=settings-card__label><span class=settings-card__label-title>API Key</span></div><div class=settings-card__control><input class=settings-card__input type=password></div></div><div class=settings-card__row><div class=settings-card__label><span class=settings-card__label-title>From Email</span><span class=settings-card__label-desc>Sender address for notifications (optional)</span></div><div class=settings-card__control><input class=settings-card__input type=email placeholder=noreply@example.com>"),oe=l('<button class="btn btn--ghost"style=color:hsl(var(--destructive))>Remove'),ge=l('<div class=settings-card><div class=settings-card__body><p class=settings-card__desc>Configure an email provider to receive notification alerts. Your API key is stored locally and never sent to any third party.</p></div><div class=settings-card__footer><button class="btn btn--outline"style=font-size:var(--font-size-sm)></button><button class="btn btn--primary"style=font-size:var(--font-size-sm)>'),ve=l("<p>Loading..."),_e=l("<option>");const ue=[{value:"mailgun",label:"Mailgun"},{value:"sendgrid",label:"SendGrid"},{value:"resend",label:"Resend"}],fe=()=>{const Y=Q.useSession(),j=()=>Y()?.data?.user?.email??"",[n,{refetch:T}]=U(W),[$,b]=o("resend"),[g,h]=o(""),[y,E]=o(""),[S,C]=o(""),[R,A]=o(!1),[K,z]=o(!1);X(()=>{const e=n();e?.configured&&e.provider&&(b(e.provider),e.domain&&E(e.domain),e.fromEmail&&C(e.fromEmail))});const G=async()=>{let e=j();try{const i=await te();i.email&&(e=i.email)}catch{}if(!e||e==="local@manifest.local"){p.error("Set a notification email in the section above before sending a test");return}A(!0);try{const i=await se({provider:$(),apiKey:g(),domain:y()||void 0,fromEmail:S()||void 0},e);i.success?p.success(`Test email sent to ${e}`):p.error(i.error??"Test email failed")}catch{}finally{A(!1)}},N=async()=>{z(!0);try{await ie({provider:$(),apiKey:g(),domain:y()||void 0,fromEmail:S()||void 0}),p.success("Email provider saved"),h(""),T()}catch{}finally{z(!1)}},O=async()=>{try{await ee(),p.success("Email provider removed"),h(""),E(""),C(""),b("resend"),T()}catch{}};return[le(),(()=>{var e=ge(),i=e.firstChild;i.firstChild;var I=i.nextSibling,v=I.firstChild,x=v.nextSibling;return a(i,m(f,{get when(){return!n.loading},get fallback(){return ve()},get children(){return[m(f,{get when(){return n()?.configured},get children(){var t=ne(),r=t.firstChild,d=r.nextSibling,w=d.firstChild,_=w.nextSibling;return a(_,()=>n()?.provider),t}}),(()=>{var t=de(),r=t.firstChild,d=r.firstChild,w=d.nextSibling,_=w.firstChild,D=r.nextSibling,k=D.firstChild;k.firstChild;var V=k.nextSibling,P=V.firstChild,L=D.nextSibling,q=L.firstChild,B=q.nextSibling,F=B.firstChild;return _.addEventListener("change",s=>b(s.currentTarget.value)),a(_,()=>ue.map(s=>(()=>{var u=_e();return a(u,()=>s.label),c(()=>u.value=s.value),u})())),a(k,m(f,{get when(){return n()?.configured},get children(){return re()}}),null),P.$$input=s=>h(s.currentTarget.value),a(t,m(f,{get when(){return $()==="mailgun"},get children(){var s=ce(),u=s.firstChild,H=u.nextSibling,M=H.firstChild;return M.$$input=J=>E(J.currentTarget.value),c(()=>M.value=y()),s}}),L),F.$$input=s=>C(s.currentTarget.value),c(()=>Z(P,"placeholder",n()?.configured?"********":"Enter API key")),c(()=>_.value=$()),c(()=>P.value=g()),c(()=>F.value=S()),t})()]}}),null),a(I,m(f,{get when(){return n()?.configured},get children(){var t=oe();return t.$$click=O,t}}),v),v.$$click=G,a(v,()=>R()?"Sending...":"Send test email"),x.$$click=N,a(x,()=>K()?"Saving...":"Save"),c(t=>{var r=R()||!g()&&!n()?.configured,d=K()||!g();return r!==t.e&&(v.disabled=t.e=r),d!==t.t&&(x.disabled=t.t=d),t},{e:void 0,t:void 0}),e})()]};ae(["input","click"]);export{fe as default};
